<div class="flex flex-col min-h-screen bg-gray-50 dark:bg-black w-screen min-[500px]:w-full">
  <!-- Tab Navigation -->
  <div class="bg-white/90 dark:bg-black/90 backdrop-blur-sm border-b border-gray-200 dark:dark:[border-color:var(--color-border)] z-50 w-full max-w-[598px] mx-auto transition-all duration-300 ease-out min-[500px]:fixed min-[500px]:top-0" 
       [class.-translate-y-full]="isTabHidden && isMobile">
    <div class="flex">
      <button 
        [ngClass]="{
          'text-blue-500': activeTab === 'for-you'
        }"
        class="w-[299px] py-3.5 text-center font-bold hover:bg-gray-100 dark:hover:dark:hover:[background-color:var(--color-surface-hover)] transition-colors dark:[color:var(--color-text)] relative"
        (click)="setActiveTab('for-you')"
      >
        For You
        <div *ngIf="activeTab === 'for-you'" class="absolute bottom-0 rounded-full left-1/2 transform -translate-x-1/2 w-14 h-1 bg-blue-500"></div>
      </button>
      <button 
        [ngClass]="{
          'text-blue-500': activeTab === 'human-drawing'
        }"
        class="w-[299px] py-3.5 text-center font-bold hover:bg-gray-100 dark:hover:dark:hover:[background-color:var(--color-surface-hover)] transition-colors dark:[color:var(--color-text)] relative"
        (click)="setActiveTab('human-drawing')"
      >
        Human Art
        <div *ngIf="activeTab === 'human-drawing'" class="absolute bottom-0 rounded-full left-1/2 transform -translate-x-1/2 w-20 h-1 bg-blue-500"></div>
      </button>
    </div>
  </div>
  
  <!-- Loading State -->
  <div *ngIf="isInitialLoading" class="flex items-center justify-center min-h-[500px] bg-white dark:bg-black">
    <!-- Clean spinner like X (Twitter) -->
    <div class="animate-spin rounded-full h-8 w-8 border-2 border-blue-500 border-t-transparent"></div>
  </div>
  
  <!-- Post Input Box (Always visible, never refreshes) -->
  <div *ngIf="activeTab === 'for-you'" 
       class="bg-white dark:bg-black border-b border-gray-200 dark:dark:[border-color:var(--color-border)]"
       [ngClass]="{
         'mt-16': !isMobile
       }">
    <div>
      <app-post-input-box
        [userAvatar]="(authService.currentUser$ | async)?.profile_picture || ''"
        [userHandle]="(authService.currentUser$ | async)?.handle || ''"
        [defaultAvatar]="defaultAvatar"
        [showCard]="false"
        (submit)="onPostSubmit($event)"
        (imageSelected)="onImageSelected($event)">
      </app-post-input-box>
    </div>
  </div>

  <!-- Content (only show when not loading) -->
  <ng-container *ngIf="!isInitialLoading">
    <!-- Error State -->
    <div *ngIf="error">
      <div class="bg-red-50 dark:bg-red-900/20 text-red-500 dark:text-red-400 p-4 rounded-lg text-center my-3">
        {{ error }}
      </div>
    </div>

    <!-- New Posts Button -->
    <div *ngIf="hasNewPosts" 
         class="bg-white dark:bg-black border-b border-gray-200 dark:dark:[border-color:var(--color-border)] py-3 hover:bg-gray-100 dark:hover:[background-color:var(--color-surface-hover)] transition-colors duration-200 cursor-pointer"
         (click)="showNewPosts()">
      <div class="text-center">
        <span class="text-blue-500 text-base">
          Show {{ newPostsCount }} new posts
        </span>
      </div>
    </div>

    <!-- Posts List -->
    <div class="posts-container">
      <ng-container *ngFor="let post of posts">
        <app-post [post]="post"
                  [showFullHeader]="true"
                  [showReplyContext]="post.post_type === 'reply' || (post.post_type === 'repost' && post.referenced_post?.post_type === 'reply')"
                  (likeClicked)="onLike(post)"
                  (repostClicked)="onRepost(post)"
                  (bookmarkClicked)="onBookmark(post)"
                  (shareClicked)="onShare(post)"
                  (postUpdated)="onPostUpdated($event)"
                  (postReported)="onPostReported($event)">
        </app-post>
      </ng-container>
      
      <!-- Load More Loading Indicator -->
      <div *ngIf="isLoadingMore" class="flex items-center justify-center py-8 bg-white dark:bg-black">
        <div class="animate-spin rounded-full h-6 w-6 border-2 border-blue-500 border-t-transparent"></div>
      </div>
      
      <!-- End of Posts Message -->
      <div *ngIf="!isLoadingMore && posts.length > 0" class="text-center py-8 text-gray-500 dark:[color:var(--color-text-secondary)]">
        <p class="text-sm">You've caught up! Check back later for more posts.</p>
      </div>
    </div>
  </ng-container>
</div>

<style>
.loading-indicator {
  display: flex;
  justify-content: center;
  padding: 20px 0;
}

.error-message {
  color: #dc3545;
  text-align: center;
  padding: 20px;
}
</style> 