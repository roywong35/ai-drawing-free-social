<div class="main-container bg-white dark:bg-black">


  <!-- Header -->
  <div class="header-section flex items-center p-4 pb-3 border-b border-gray-200 dark:[border-color:var(--color-border)]">
    <!-- Left side: Back button -->
    <button (click)="onBack()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-900 dark:[color:var(--color-text)]">
      <i class="fas fa-arrow-left text-lg"></i>
    </button>

    <!-- Center: Title (absolute center) -->
    <h2 class="flex-1 text-xl font-bold text-gray-900 dark:text-white text-center">Drafts</h2>

    <!-- Right side: Edit button (fixed width) -->
    <button (click)="toggleEditMode()" class="w-12 h-8 flex items-center justify-center text-sm font-medium rounded-full hover:bg-gray-100 dark:hover:bg-gray-900 dark:[color:var(--color-text)]">
      {{ isEditMode ? 'Done' : 'Edit' }}
    </button>
  </div>

  <!-- Tabs -->
  <div class="border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
    <div class="flex">
      <button 
        (click)="selectedTab = 'unsent'" 
        [class]="selectedTab === 'unsent' ? 'border-b-2 border-blue-500 text-blue-600 dark:text-blue-400' : 'text-gray-600 dark:text-gray-400'"
        class="flex-1 py-3 px-4 text-center font-medium text-sm hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
        Unsent
      </button>
      <button 
        (click)="selectedTab = 'scheduled'" 
        [class]="selectedTab === 'scheduled' ? 'border-b-2 border-blue-500 text-blue-600 dark:text-blue-400' : 'text-gray-600 dark:text-gray-400'"
        class="flex-1 py-3 px-4 text-center font-medium text-sm hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
        Scheduled
      </button>
    </div>
  </div>

  <!-- DEBUG: Temporary debug button -->
  <div class="p-2 bg-yellow-100 dark:bg-yellow-900/20 text-center text-xs">
    <button (click)="debugScheduledPosts()" class="bg-yellow-500 text-white px-2 py-1 rounded mr-2">Debug Posts</button>
    <button (click)="clearAllData()" class="bg-red-500 text-white px-2 py-1 rounded mr-2">Clear All Data</button>
    <button (click)="openNewModal()" class="bg-green-500 text-white px-2 py-1 rounded">Open New Clean Modal</button>
    <div class="mt-1">
      Posts: {{ scheduledPosts.length }} | Tab: {{ selectedTab }} | isScheduledTab: {{ isScheduledTab() }}
    </div>
  </div>

  <!-- Top Controls - Edit Mode -->
  <div class="px-3 py-2 border-b border-gray-200 dark:[border-color:var(--color-border)] bg-gray-50 dark:bg-gray-900" 
       [class.hidden]="!isEditMode">
    <div class="flex gap-3 items-start justify-between">
      <!-- Select All Section aligned with checkboxes -->
      <div class="flex gap-3 items-start">
        <!-- Checkbox aligned with individual checkboxes -->
        <div class="w-4 flex-shrink-0 mt-1">
          <input 
            type="checkbox" 
            [checked]="selectedTab === 'unsent' ? allDraftsSelected : allScheduledSelected"
            (click)="selectedTab === 'unsent' ? selectAllDrafts() : selectAllScheduled()"
            class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500 dark:focus:ring-blue-600">
        </div>
        
        <!-- Select All Text aligned with content -->
        <div class="flex-1 text-gray-900 dark:text-white">
          <button 
            (click)="selectedTab === 'unsent' ? selectAllDrafts() : selectAllScheduled()"
            class="text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300">
            {{ (selectedTab === 'unsent' ? allDraftsSelected : allScheduledSelected) ? 'Deselect All' : 'Select All' }}
          </button>
        </div>
      </div>

      <!-- Delete Button -->
      <button 
        [disabled]="!hasSelectedItems"
        (click)="deleteSelectedItems()"
        class="text-sm font-medium transition-colors"
        [class.text-red-500]="hasSelectedItems"
        [class.hover:text-red-600]="hasSelectedItems"
        [class.text-red-300]="!hasSelectedItems"
        [class.cursor-not-allowed]="!hasSelectedItems">
        Delete
      </button>
    </div>
  </div>

  <!-- Tab Content - Scrollable Area -->
  <div class="content-area">
    <!-- Unsent Posts Tab -->
    <div *ngIf="isUnsentTab()">
      <div *ngIf="drafts.length === 0" class="text-center py-6 px-4 text-gray-500 dark:text-gray-400">
        <i class="fas fa-file-alt text-4xl mb-4 opacity-50"></i>
        <p class="text-lg">No drafts saved</p>
        <p class="text-sm">Your saved drafts will appear here</p>
      </div>

      <div *ngFor="let draft of drafts" class="px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors cursor-pointer border-b border-gray-200 dark:border-gray-700" (click)="!isEditMode && onDraftEdit(draft)">
        <!-- Main Content Area -->
        <div class="flex gap-3 items-start">
          <!-- Checkbox (Edit Mode) - Always reserve space -->
          <div class="w-4 flex-shrink-0 mt-1">
            <input 
              *ngIf="isEditMode"
              type="checkbox" 
              [checked]="selectedDraftIds.has(draft.id)"
              (change)="toggleDraftSelection(draft.id)"
              (click)="$event.stopPropagation()"
              class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500 dark:focus:ring-blue-600">
          </div>
          
          <!-- Draft Content -->
          <div class="flex-1 text-gray-900 dark:text-white">
            <!-- Scheduled Time -->
            <div *ngIf="draft.scheduledTime" class="flex items-center text-xs text-blue-600 dark:text-blue-400 mb-1">
              <i class="fas fa-clock mr-1"></i>
              Scheduled for {{ formatScheduledTime(draft.scheduledTime) }}
            </div>
          <p class="mb-1">{{ getPreviewText(draft.content) }}</p>
          
          <!-- Images Preview -->
          <div *ngIf="draft.images && draft.images.length > 0" class="flex gap-2 mb-1">
            <div *ngFor="let image of draft.images.slice(0, 3)" class="w-8 h-8 bg-gray-200 dark:bg-gray-700 rounded border">
              <img [src]="image.preview" class="w-full h-full object-cover rounded" alt="Draft image">
            </div>
            <div *ngIf="draft.images.length > 3" class="w-8 h-8 bg-gray-200 dark:bg-gray-700 rounded border flex items-center justify-center text-xs text-gray-600 dark:text-gray-300">
              +{{ draft.images.length - 3 }}
            </div>
          </div>

          <!-- Quote Post Preview -->
          <div *ngIf="draft.quotePost" class="border border-gray-300 dark:border-gray-600 rounded-lg p-3 bg-gray-50 dark:bg-gray-800 text-sm">
            <div class="flex items-center gap-2 mb-1">
              <span class="font-semibold">{{ draft.quotePost.author.username }}</span>
              <span class="text-gray-500 dark:text-gray-400">{{ draft.quotePost.author.handle }}</span>
            </div>
            <p class="text-gray-700 dark:text-gray-300">{{ getPreviewText(draft.quotePost.content) }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Scheduled Posts Tab -->
    <div *ngIf="isScheduledTab()">
      <div style="background: red; color: white; padding: 20px; font-size: 24px;">
        SIMPLE TEST - CAN YOU SEE THIS?
      </div>
             <div style="background: blue; color: white; padding: 20px; margin-top: 10px;">
         Static text - no variables
       </div>
    </div>
  </div>
</div> 