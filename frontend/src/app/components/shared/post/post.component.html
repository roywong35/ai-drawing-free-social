<div [class]="'post-container pb-1 pt-3 pl-3 pr-3 hover:bg-gray-50 ' + (!isConnectedToParent ? 'border-b border-gray-200' : '')">
  <!-- Repost header -->
  <div *ngIf="post.post_type === 'repost'" class="flex items-center gap-2 mb-2 text-gray-500">
    <i class="fas fa-retweet"></i>
    <span class="text-sm">You reposted</span>
  </div>

  <!-- User avatar and content -->
  <div class="flex space-x-3">
    <!-- Avatar container with fixed width for consistent line positioning -->
    <div class="w-[40px] flex-shrink-0 relative z-10">
      <img [src]="post.author.profile_picture || defaultAvatar" 
           [alt]="post.author.username" 
           class="h-10 w-10 rounded-full cursor-pointer"
           (click)="navigateToProfile($event)"
           (error)="onImageError($event)">
    </div>

    <!-- Content section -->
    <div class="flex-grow min-w-0">
      <!-- Author info and timestamp -->
      <div class="cursor-pointer" (click)="navigateToPost()">
        <div class="flex items-center space-x-1">
          <p class="text-[16px] font-extrabold text-gray-900 hover:underline cursor-pointer font-['Inter']" (click)="navigateToProfile($event)">
            {{ post.author.username }}
          </p>
          <p class="text-[15px] text-gray-500">{{"@"}}{{ post.author.handle }}</p>
          <span class="text-[15px] text-gray-500">Â·</span>
          <p class="text-[15px] text-gray-500">{{ post.created_at | timeAgo }}</p>
        </div>

        <!-- Post content -->
        <p class="text-gray-800 mt-1 break-words whitespace-pre-wrap">{{ post.content }}</p>

        <!-- Post images -->
        <div *ngIf="post.images?.length" class="mt-3 relative rounded-2xl overflow-hidden bg-gray-100"
             [class.h-80]="(post.images?.length ?? 0) === 1"
             [class.h-60]="(post.images?.length ?? 0) > 1">
          <div class="flex flex-wrap h-full">
            <div *ngFor="let image of post.images; let i = index" 
                 [class]="getImageLayoutClass(i, post.images?.length || 0)"
                 class="relative p-0.5">
              <img [src]="image.image" 
                   [alt]="'Post image ' + (i + 1)"
                   class="w-full h-full object-cover"
                   [class.rounded-lg]="(post.images?.length ?? 0) > 1"
                   (error)="onImageError($event)">
            </div>
          </div>
        </div>
      </div>

      <!-- Post actions -->
      <div class="flex items-center justify-between mt-2">
        <!-- Reply button -->
        <button class="flex items-center gap-2 text-gray-500 hover:text-blue-500 p-1.5 rounded-full transition-colors group"
                (click)="onReply($event)">
          <i class="far fa-comment text-[18px] group-hover:text-blue-500"></i>
          <span class="text-sm">{{ post.replies_count || 0 }}</span>
        </button>

        <!-- Repost button -->
        <div class="relative">
          <button class="flex items-center gap-2 text-gray-500 hover:text-green-500 p-1.5 rounded-full transition-colors group"
                  [class.text-green-500]="post.is_reposted"
                  (click)="toggleRepostMenu($event)">
            <i class="fas fa-retweet text-[18px]" [class.text-green-500]="post.is_reposted"></i>
            <span class="text-sm" [class.text-green-500]="post.is_reposted">{{ post.reposts_count || 0 }}</span>
          </button>

          <!-- Repost Menu -->
          <app-repost-menu *ngIf="showRepostMenu"
                          [isReposted]="post.is_reposted"
                          (optionSelected)="onRepostOption($event)"
                          (closeMenu)="showRepostMenu = false">
          </app-repost-menu>
        </div>

        <!-- Like button -->
        <button class="flex items-center gap-2 text-gray-500 hover:text-red-500 p-1.5 rounded-full transition-colors group"
                (click)="onLike($event)">
          <i [class]="post.is_liked ? 'fas fa-heart text-red-500' : 'far fa-heart'" class="text-[18px] group-hover:text-red-500"></i>
          <span class="text-sm" [class.text-red-500]="post.is_liked">{{ post.likes_count }}</span>
        </button>

        <!-- Share button -->
        <button class="flex items-center gap-2 text-gray-500 hover:text-blue-500 p-1.5 rounded-full transition-colors group"
                (click)="onShare($event)">
          <i class="far fa-share-square text-[18px] group-hover:text-blue-500"></i>
        </button>

        <!-- Bookmark button -->
        <button class="flex items-center gap-2 text-gray-500 hover:text-blue-500 p-1.5 rounded-full transition-colors group"
                (click)="onBookmark($event)">
          <i [class]="post.is_bookmarked ? 'fas fa-bookmark text-blue-500' : 'far fa-bookmark'" class="text-[18px] group-hover:text-blue-500"></i>
        </button>
      </div>
    </div>
  </div>
</div> 